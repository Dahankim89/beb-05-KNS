openapi: 3.0.0
info:
  description: This is KNS Project API service.
  version: 1.0.0
  title: KNS - Incentive Community Project
  contact:
    email: rlawkdgks11@gmail.com
servers:
  - url: http://localhost:8080
tags:
  - name: auth
    description: Methods to handle authentication
  - name: user
    description: Methods to access and manage user
  - name: post
    description: Methods to access and manage post
  - name: nft
    description: Methods to access and manage nft
  - name: token
    description: Methods to access and manage token
paths:
  /auth/signup:
    post:
      tags:
        - auth
      summary: 회원가입
      description: 회원 정보를 입력받아서 계정을 만들고 지갑 생성
      operationId: signupUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
        required: true
      responses:
        '201':
          description: successful created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthApiResponse'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorApiResponse'
        '409':
          description: User already exists
  /auth/login:
    post:
      tags:
        - auth
      summary: 로그인
      description: 로그인
      operationId: loginUser
      parameters:
        - name: userId
          in: query
          description: 사용자 아이디
          required: false
          schema:
            type: string
        - name: password
          in: query
          description: 비밀번호
          required: false
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthApiResponse'
        '400':
          description: Invalid userId/password supplied
  /auth/logout:
    get:
      tags:
        - auth
      summary: 로그아웃
      description: '로그아웃 refresh token 만료시킴'
      operationId: logoutUser
      parameters: []
      responses:
        default:
          description: successful operation
  /user/{userId}:
    get:
      tags:
        - user
      summary: 마이페이지 및 유저의 상세 정보
      description: |
        userId로 user 테이블 정보를 가져온다.
      operationId: getUserById
      parameters:
        - name: userId
          in: path
          required: true
          description: 사용자 아이디
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserApiResponse'
        '400':
          description: Invalid User ID supplied
        '404':
          description: User not found
          
  /user/{address}:
    post:
      tags:
        - user
      summary: 무료로 이더 받기(faucet)
      description: NFT 구매, 전송 시 가스비가 들기때문에 이더 받기 추가
      operationId: getEth
      parameters:
        - name: address
          in: path
          required: true
          description: 지갑 주소
          schema:
            type: string
      responses:
        '200':
          description: successful operation
        '400':
          description: Invalid address supplied
        '404':
          description: User not found
  /post:
    post:
      tags:
        - post
      summary: 게시글 작성
      description: |
        게시글 작성
      operationId: savePost
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostRegistration'
        required: true
      responses:
        '201':
          description: successful created
        '405':
          description: Invalid input
    
    get:
      tags:
        - post
      summary: 전체 게시글 가져오기
      description: |
        등록한 전체 게시글 정보를 가져온다.
      operationId: getAllPosts
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostApiResponse'
        '404':
          description: Post not found
          
  /post/{postId}:
    put:
      tags:
        - post
      summary: 게시글 수정
      description: |
        게시글 수정
      operationId: updatePost
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 아이디
          schema:
            type: integer
            format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostUpdate'
        required: true
      responses:
        '200':
          description: successful operation
        '400':
          description: Invalid ID supplied
        '403':
          description: Only you can update or delete it
        '404':
          description: Post not found

    delete:
      tags:
        - post
      summary: 게시글 삭제
      description: |
        게시글 삭제
      operationId: deletePost
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 아이디
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
        '400':
          description: Invalid ID supplied
        '403':
          description: Only you can update or delete it
        '404':
          description: Post not found

    get:
      tags:
        - post
      summary: 게시글 리스트에서 게시글 상세 정보 가져오기
      description: |
        게시글 상세 정보 가져오기
      operationId: getPostById
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 아이디
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostApiResponse'
        '400':
          description: Invalid Post ID supplied
        '404':
          description: Post not found
         
  /post/{userId}:
    get:
      tags:
        - post
      summary: 마이페이지에서 유저의 게시글 정보 가져오기
      description: |
        유저의 게시글 정보 가져오기
      operationId: getPostByUserId
      parameters:
        - name: userId
          in: path
          required: true
          description: 사용자 아이디
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostApiResponse'
        '400':
          description: Invalid User ID supplied
        '404':
          description: Post not found
          
  /post/like/{postId}:
    put:
      tags:
        - post
      summary: 게시글 좋아요 업데이트
      description: |
        게시글 좋아요 업데이트
      operationId: likePost
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 아이디
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
        '400':
          description: Invalid ID supplied
        '404':
          description: Post not found
      
  /post/{postId}/comment:
    post:
      tags:
        - post
      summary: 게시글 댓글 작성
      description: |
        게시글 작성
      operationId: saveComment
      parameters:
        - name: postId
          in: path
          required: true
          description: 게시글 아이디
          schema:
            type: integer
            format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentRegistration'
        required: true
      responses:
        '201':
          description: successful created
        '405':
          description: Invalid input
          
  /post/comment/{commentId}:
    put:
      tags:
        - post
      summary: 게시글 댓글 수정
      description: |
        게시글 댓글 수정
      operationId: updateComment
      parameters:
        - name: commentId
          in: path
          required: true
          description: 댓글 아이디
          schema:
            type: integer
            format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentUpdate'
        required: true
      responses:
        '200':
          description: successful operation
        '400':
          description: Invalid ID supplied
        '403':
          description: Only you can update or delete it
        '404':
          description: Comment not found

    delete:
      tags:
        - post
      summary: 게시글 삭제
      description: |
        게시글 삭제
      operationId: deleteComment
      parameters:
        - name: commentId
          in: path
          required: true
          description: 댓글 아이디
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
        '400':
          description: Invalid ID supplied
        '403':
          description: Only you can update or delete it
        '404':
          description: Comment not found
          
  /nft:
    post:
      tags:
        - nft
      summary: NFT 생성
      description: |
        NFT 생성
      operationId: createNFT
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NFTCreate'
        required: true
      responses:
        '201':
          description: successful created
        '405':
          description: Invalid input
          
    get:
      tags:
        - nft
      summary: 전체 NFT 정보 가져오기
      description: |
        NFT 전체 정보 조회
      operationId: getAllNFT
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NFTApiResponse'
                
  /nft/{userId}:
    get:
      tags:
        - nft
      summary: 사용자 아이디로 NFT 정보 가져오기
      description: |
        사용자 아이디로 NFT 정보 조회
      operationId: getNFTByUserId
      parameters:
        - name: userId
          in: path
          required: true
          description: 사용자 아이디
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NFTApiResponse'
        '400':
          description: Invalid ID supplied
        '404':
          description: NFT not found
          
  /nft/{nftId}:
    get:
      tags:
        - nft
      summary: nft 아이디로 NFT 정보 가져오기
      description: |
        nft 아이디로 NFT 정보 조회
      operationId: getNFTById
      parameters:
        - name: nftId
          in: path
          required: true
          description: nft Id
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NFTApiResponse'
        '400':
          description: Invalid ID supplied
        '404':
          description: NFT not found
          
  /nft/{nftId}/transfer:
    post:
      tags:
        - nft
      summary: NFT 전송
      description: |
        NFT 전송
      operationId: transferNFT
      parameters:
        - name: nftId
          in: path
          required: true
          description: 전송할 NFT ID
          schema:
            type: integer
            format: int64
        - name: address
          in: query
          description: 전송 대상인 지갑 주소
          schema:
            type: string
      responses:
        '200':
          description: successful operation
        '400':
          description: Invalid Address supplied
        '404':
          description: NFT not found
          
  /nft/{nftId}/buy:
    post:
      tags:
        - nft
      summary: NFT 구매
      description: |
        NFT 구매
      operationId: buyNFT
      parameters:
        - name: nftId
          in: path
          required: true
          description: 구매할 NFT ID
          schema:
            type: integer
            format: int64
        - name: userId
          in: query
          description: 구매할 User ID
          schema:
            type: string
        - name: price
          in: query
          description: 구매 가격
          schema:
            type: string
      responses:
        '200':
          description: successful operation
        '400':
          description: Invalid ID supplied
        '404':
          description: NFT not found
          
  /token/{userId}:
    get:
      tags:
        - token
      summary: 사용자 아이디로 토큰 수량 가져오기
      description: |
        사용자 아이디로 토큰 수량 가져오기
      operationId: geTokenByUserId
      parameters:
        - name: userId
          in: path
          required: true
          description: User ID
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/token'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundApiResponse'
                
  /token/{userId}/transfer:
    post:
      tags:
        - token
      summary: ERC20 토큰 전송
      description: |
        ERC20 토큰 전송
      operationId: transferToken
      parameters:
        - name: userId
          in: path
          required: true
          description: 토큰 전송할 User ID
          schema:
            type: string
        - name: toUserId
          in: query
          description: 토큰 전송 대상 User ID
          schema:
            type: string
        - name: tokenAmount
          in: query
          description: 전송할 토큰 수량
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: successful operation
        '400':
          description: Invalid Address supplied
        '404':
          description: Token not found
components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
        username:
          type: string
        createdAt:
          type: string
          format: date-time
          description: Creation date
          example: '2021-01-30T08:30:20.000Z'
        address:
          type: string
        tokenAmount:
          type: integer
          format: int32
        ethAmount:
          type: integer
          format: int32
        mnemonicWord:
          type: string
        privateKey:
          type: string
      required:
        - id
        - username
        - address
        - tokenAmount
        - ethAmount
        - mnemonicWord
        - privateKey
      example: null
    UserRegistration:
      type: object
      title: User registration details
      properties:
        userName:
          type: string
        password:
          type: string
          minLength: 5
        address:
          type: string
        tokenAmount:
          type: integer
          format: int32
        ethAmount:
          type: integer
          format: int32
        mnemonicWord:
          type: string
        privateKey:
          type: string
      required:
        - userName
        - password
        - address
        - mnemonicWord
        - privateKey
      example: null
    Post:
      type: object
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: string
        userName:
          type: string
        title:
          type: string
        content:
          type: string
        createdAt:
          type: string
          format: date-time
          description: Creation date
          example: '2021-01-30T08:30:20.000Z'
        img:
          type: string
        hit:
          type: integer
          format: int32
        like:
          type: integer
          format: int32
      required:
        - id
      example: null
    PostRegistration:
      type: object
      title: Post registration details
      properties:
        userId:
          type: string
        title:
          type: string
        content:
          type: string
        img:
          type: string
      required:
        - userId
        - title
        - content
      example: null
    PostUpdate:
      type: object
      title: Post update details
      properties:
        title:
          type: string
        content:
          type: string
        img:
          type: string
      required:
        - title
        - content
      example: null
    Comment:
      type: object
      properties:
        id:
          type: integer
          format: int64
        postId:
          type: integer
          format: int64
        userId:
          type: string
        userName:
          type: string
        comment:
          type: string
        createdAt:
          type: string
          format: date-time
          description: Creation date
          example: '2021-01-30T08:30:20.000Z'
      required:
        - id
        - postId
        - userId
        - userName
        - comment
      example: null
    CommentRegistration:
      type: object
      title: Comment registration details
      properties:
        postId:
          type: integer
          format: int64
        userId:
          type: string
        userName:
          type: string
        comment:
          type: string
      required:
        - postId
        - userId
        - userName
        - comment
      example: null
    CommentUpdate:
      type: object
      title: Comment update details
      properties:
        comment:
          type: string
      required:
        - comment
      example: null
    nft:
      type: object
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: string
        tokenId:
          type: string
        tokenName:
          type: string
        desc:
          type: string
        tx_hash:
          type: string
        tokenURI:
          type: string
        img:
          type: string
        createdAt:
          type: string
          format: date-time
          description: Creation date
          example: '2021-01-30T08:30:20.000Z'
        isBuy:
          type: boolean
        Price:
          type: integer
          format: int32
        prevUserId:
          type: string
      required:
        - id
        - userId
        - tokenName
        - img
        - Price
      example: null
    NFTCreate:
      type: object
      title: NFT Create details
      properties:
        userId:
          type: string
        tokenId:
          type: string
        tokenName:
          type: string
        desc:
          type: string
        tx_hash:
          type: string
        tokenURI:
          type: string
        img:
          type: string
      required:
        - userId
        - tokenId
        - tokenName
        - tokenURI
        - img
        - isBuy
      example: null
    token:
      type: object
      properties:
        userId:
          type: string
        tokenAmount:
          type: integer
          format: int32
      required:
        - userId
        - tokenAmount
      example: null
    AuthApiResponse:
      type: object
      properties:
        token:
          type: string
        username:
          type: string
      required:
        - token
        - username
      example:
        token: >-
          eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
        username: johndoe
    UserApiResponse:
      type: array
      items:
        $ref: '#/components/schemas/User'
      example: null
    PostApiResponse:
      type: array
      items:
        $ref: '#/components/schemas/Post'
      example: null
    NFTApiResponse:
      type: array
      items:
        $ref: '#/components/schemas/nft'
      example: null
    SuccessApiResponse:
      type: object
      properties:
        message:
          type: string
      required:
        - message
      example:
        message: Success!!
    ErrorApiResponse:
      type: object
      properties:
        message:
          type: string
      required:
        - message
      example:
        message: Something went wrong 🤪
    NotFoundApiResponse:
      type: object
      properties:
        message:
          type: string
      required:
        - message
      example:
        message: Not found
